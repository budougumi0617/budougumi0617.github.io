<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
    
    
      <link href="/css/fonts.css" rel="stylesheet" type="text/css">
    
  

  
  <title>[k8s]Cloud Native Developers JP 第3回勉強会 #cndjp3 参加メモ - My External Storage</title>

  
  
  <link rel="stylesheet" href="/css/hugo-octopress.css">

  
  

  
    <link rel="stylesheet" href="/css/fork-awesome.min.css">
  

  
  <link href="https://budougumi0617.github.io/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="">

  
  <meta name="generator" content="Hugo 0.50" />

  
  

  
  
    

  
    <meta name="twitter:card" content="summary"/>
  
  
  <meta property="og:url" content="https://budougumi0617.github.io/2018/02/03/kubernetes-with-availability-cndjp3/"/>
  <meta property="og:type" content="article"/>
  <meta property="og:title" content="[k8s]Cloud Native Developers JP 第3回勉強会 #cndjp3 参加メモ - My External Storage"/>
  <meta property="og:description" content="いつも楽しく学ばせていただいているオラクル早川さん主催のcndjp。 今回は「Kubernetesで実現する高可用性システム」というテーマでK"/>
  
  <meta name="twitter:title" content="[k8s]Cloud Native Developers JP 第3回勉強会 #cndjp3 参加メモ - My External Storage"/>
  <meta name="twitter:description" content="いつも楽しく学ばせていただいているオラクル早川さん主催のcndjp。 今回は「Kubernetesで実現する高可用性システム」というテーマでK"/>
  <meta name="twitter:site" content="@budougumi0617"/>
  <meta name="twitter:domain" content="budougumi0617.github.io"/>
  <meta name="twitter:creator" content="@budougumi0617"/>



  

  
  <script type="text/javascript">
    (function(add, cla){window['UserHeatTag']=cla;window[cla]=window[cla]||function(){(window[cla].q=window[cla].q||[]).push(arguments)},window[cla].l=1*new Date();var ul=document.createElement('script');var tag = document.getElementsByTagName('script')[0];ul.async=1;ul.src=add;tag.parentNode.insertBefore(ul,tag);})('//uh.nakanohito.jp/uhj2/uh.js', '_uhtracker');_uhtracker({id:'uhUEw1Gd9C'});
  </script>
  
</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://budougumi0617.github.io/">My External Storage</a></h1>
    <h2></h2>
</hgroup></header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
        <option value="https://budougumi0617.github.io/">» Home</option>
      
        <option value="https://budougumi0617.github.io/2017/07/11/about-this-site/">» About</option>
      
        <option value="https://budougumi0617.github.io/post/">» Archives</option>
      

  </select>
</fieldset>


<ul class="main-navigation">
  
  
    
      <li><a href="https://budougumi0617.github.io/" title="Home">Home</a></li>
    
  
    
      <li><a href="https://budougumi0617.github.io/2017/07/11/about-this-site/" title="About"  target="_blank" >About</a></li>
    
  
    
      <li><a href="https://budougumi0617.github.io/post/" title="Archives"  target="_blank" >Archives</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="https://budougumi0617.github.io/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
    <p class="meta">Feb 3, 2018
         - 6 minute read 
         - <a href="https://budougumi0617.github.io/2018/02/03/kubernetes-with-availability-cndjp3/#disqus_thread">Comments</a>

        
        
        
            - <a class="label" href="https://budougumi0617.github.io/categories/report/">report </a><a class="label" href="https://budougumi0617.github.io/categories/k8s/">k8s </a>
        
    </p>
    <h1 class="entry-title">
         [k8s]Cloud Native Developers JP 第3回勉強会 #cndjp3 参加メモ 
    </h1>
</header>


        <div class="addthis_inline_share_toolbox"></div>

        <div class="entry-content">
          
          
          
          
          

<p>いつも楽しく学ばせていただいているオラクル早川さん主催のcndjp。
今回は「Kubernetesで実現する高可用性システム」というテーマでKubernetes(k8s)と可用性について、ハンズオンでは実際にk8sとApache Kafkaを使った構成に対して、chaoskubeによるカオスエンジニアリングを行った。</p>

<ul>
<li><a href="https://www.slideshare.net/charlier-shoe/kubernetes-cndjp3/charlier-shoe/kubernetes-cndjp3">Kubernetes × 可用性 &ndash; cndjp第3回勉強会</a></li>
<li><a href="https://github.com/oracle-japan/cndjp3">https://github.com/oracle-japan/cndjp3</a>

<ul>
<li><a href="https://github.com/oracle-japan/cndjp3/blob/master/handson1.md">CNDJP #3 ハンズオンチュートリアル Part 1</a></li>
<li><a href="https://github.com/oracle-japan/cndjp3/blob/master/handson2.md">CNDJP #3 ハンズオンチュートリアル Part 2</a></li>
</ul></li>
</ul>

<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>URL</td>
<td><a href="https://cnd.connpass.com/event/75617/">https://cnd.connpass.com/event/75617/</a></td>
</tr>

<tr>
<td>会場</td>
<td>オラクル青山センター 13F セミナールーム</td>
</tr>

<tr>
<td>日時</td>
<td>2018/01/31(水) 18:30 〜 20:30</td>
</tr>

<tr>
<td>ハッシュタグ</td>
<td><a href="https://twitter.com/search?q=%23cndjp3">#cndjp3</a></td>
</tr>

<tr>
<td>資料</td>
<td><a href="https://www.slideshare.net/charlier-shoe/kubernetes-cndjp3/charlier-shoe/kubernetes-cndjp3">Kubernetes × 可用性 &ndash; cndjp第3回勉強会</a></td>
</tr>
</tbody>
</table>

<h1 id="tl-dr">TL;DR</h1>

<ul>
<li>マイクロサービスの4層アーキテクチャごとの可用性</li>
<li>Kafkaを使ったチャットアプリサービスをk8sにデプロイ</li>
<li>chaoskubeを使ってカオステストを実施</li>
</ul>

<h1 id="マイクロサービス4層アーキテクチャ">マイクロサービス4層アーキテクチャ</h1>

<p><a href="http://amazon.jp/dp/B01N48GFCQ">Production-Ready Microservices</a>の著者である、Susan Fowler氏はマイクロサービスを4層アーキテクチャとして定義している。</p>

<p><a href="https://www.susanjfowler.com/blog/2016/12/18/the-four-layers-of-microservice-architecture">The Four Layers Of Microservice Architecture</a></p>

<ul>
<li>マイクロサービス（サービス本体）</li>
<li>アプリケーションプラットフォーム（ロギング、監視）</li>
<li>通信（サービス間の通信）</li>
<li>ハードウェア</li>
</ul>

<p>ハードウェア部分をクラウド、サービス間の通信をk8sに任せる。アプリケーションプラットフォーム以上についてもk8sとの組み合わせで高機能・高可用性を実現できる。
高可用性を実現するためには、レイヤー毎に単一障害点（SPOF）を考える必要がある。</p>

<p>単一障害点…システム全体に影響を及ぼす障害。認証とかDBとか。</p>

<h1 id="マイクロサービス層の可用性">マイクロサービス層の可用性</h1>

<h2 id="マイクロサービスのトレードオフ">マイクロサービスのトレードオフ</h2>

<p><a href="http://postd.cc/microservice-trade-offs/">マイクロサービスのトレードオフ</a></p>

<p>マイクロサービスを利用することで開発者はモジュールの分割、個別デプロイなど大きなメリットを得るが、一方で無視できないデメリットも多い。その中の一つとして、サービス境界（サービス間の結合部分）に対する可用性・回復性の担保がある。
マイクロサービスの場合、当然モノリシックな構成よりも個々の機能が分裂されているので、SPOFとなり得る部分が多くなる。</p>

<p>マイクロサービスの設計としては、それらに対してヘルスチェックパターン、、サーキットブレーカーパターンなどを適用して回避する。</p>

<ul>
<li><a href="http://microservices.io/patterns/observability/health-check-api.html">Pattern: Health Check API</a></li>
<li><a href="http://microservices.io/patterns/reliability/circuit-breaker.html">Pattern: Circuit Breaker</a></li>
<li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/patterns/category/resiliency">回復性のパターン</a>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/patterns/health-endpoint-monitoring">正常性エンドポイントの監視パターン</a></li>
<li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/patterns/circuit-breaker">サーキット ブレーカー パターン</a></li>
</ul></li>
<li><a href="https://www.youtube.com/watch?v=pKO33eMwXRs">YouTube:Building Fault Tolerant Microservices</a></li>
</ul>

<p>他にもバルクヘッドパターンなどがある。</p>

<h2 id="サービスメッシュを使ったサービス境界に対する障害対策">サービスメッシュを使ったサービス境界に対する障害対策</h2>

<ul>
<li><a href="https://www.infoq.com/jp/news/2017/06/istio">Istio: マイクロサービスのためのサービスメッシュ</a></li>
</ul>

<p>モノリシックなサービスと比較してマイクロサービスの個々のサービスにフォーカスした可用性の担保は簡単になる。<br />
サービス境界に対する可用性の担保はk8sの場合、サービスメッシュを利用すると簡単に導入できる。<br />
サービスメッシュとはサービス間のミドルウェアで、モノリシックなサービスだとnginxがやっているような機能をネットワーク間の処理をいい感じにやってくれるツールの総称。IstioやLinkerdなどがある。（これに関しては次回のcndjpで取り上げていただけるらしい）</p>

<h1 id="ハンズオン1-apache-kafkaを利用した簡易チャットアプリをk8sにデプロイする">ハンズオン1: Apache Kafkaを利用した簡易チャットアプリをk8sにデプロイする</h1>

<ul>
<li><a href="https://github.com/oracle-japan/cndjp3/blob/master/handson1.md">CNDJP #3 ハンズオンチュートリアル Part 1</a></li>
</ul>

<p>一般的なWeb3層アプリケーションで考えると可用性の担保としてセッションステートの分離、DBの可用構成がある。<br />
k8s上でもセッションステートをアプリから分離してRedisなどで可用性を担保することになる。こうすることでユーザーのセッションをキープしたままサービスの更新などが可能になる。</p>

<p>Apache KafkaはLAMPスタックから置き換わったSMACKスタックを担うOSSである。<br />
2011年にLinkedInから公開されたオープンソースの分散メッセージングシステム。Kafkaによってメッセージの中継を複数のPodで分散して行う。それぞれのPodはお互いにバックアップを取るので、可用性、回復性が実現できる。</p>

<p>ハンズオンではスペック不足？で動かない人が多かったらしいが、自分のMacbook2015は手順通りにやれば特に問題なかった。</p>

<h1 id="アプリケーションプラットフォーム層の可用性">アプリケーションプラットフォーム層の可用性</h1>

<p>##リリースと可用性
アプリケーションプラットフォーム層の可用性にはリリースも関連してくる。<br />
変更は障害のリスクであり、バグを含んでいないものをミスなくリリースできるCI/CD環境が用意されている必要がある。<br />
Istioなどを利用すればセンシティブなカナリーデプロイメントも可能</p>

<h1 id="kubernetes層-ハードウェア層の可用性">Kubernetes層・ハードウェア層の可用性</h1>

<h2 id="巨人の肩に乗る">巨人の肩に乗る</h2>

<p><a href="https://kubernetes.io/docs/admin/high-availability/building/">Building High-Availability Clusters</a></p>

<p>一言でいうと自前で可用性の高いk8sのクラスター構成を用意するのはめちゃくちゃめんどくさい。
ハードウェアにしても自前でマルチゾーン構成を用意するはよほどの資金力が必要。クラウドサービスに頼るのがよさそう。</p>

<h1 id="ハンズオン2-chaoskubeによるランダムなpodのシャットダウン">ハンズオン2: chaoskubeによるランダムなPodのシャットダウン</h1>

<ul>
<li><a href="https://github.com/oracle-japan/cndjp3/blob/master/handson2.md">CNDJP #3 ハンズオンチュートリアル Part 2</a></li>
<li><a href="https://www.skyarch.net/blog/?p=13294">【AWS re:Invent 2017】「カオスエンジニアリング」について</a></li>
</ul>

<p>ハンズオン1で作成したKafkaを利用したチャットアプリに対して、k8s Podをランダムにダウンさせるカオスエンジニアリングを実施した。
k8sのPodに対してカオスエンジニアリングを行うにはchaoskubeがあるようだ。</p>

<p><a href="https://github.com/linki/chaoskube">https://github.com/linki/chaoskube</a></p>

<p>Macの場合は<code>brew install httpd</code>で<code>ab</code>コマンドが利用できるようになる。
たしかにPodは落ちているのだが、メッセージの欠損なくチャットが継続された。</p>

<h1 id="終わってみて">終わってみて</h1>

<p>実は最初の一時間くらいは<code>vagrant</code>上のk8sクラスターが全然起動しなくて（正確にいうとssh接続が出来なくて<code>vagrant up</code>が成功しなくて）、
話をちゃんと聞けていなかった。ベースがなくて初めて聞く事ばかりだし、ちょっと動かなくなるとお手上げになってしまうので、
自己学習が必要だなと感じる。Kodecataとかで勉強しないと。</p>

<p><a href="https://www.katacoda.com/courses/kubernetes">Learn Kubernetes using Interactive Browser-Based Scenarios</a></p>

<p>次回はIstio。名前しか知らないのでちょっとでもわかるようになるといいなー。</p>

<h1 id="参考">参考</h1>

<ul>
<li><a href="https://www.infoq.com/jp/news/2017/03/production-ready-microservices">Susan Fowler氏に聞く - 実用段階のマイクロサービスとは</a></li>
<li><a href="https://www.susanjfowler.com/blog/2016/12/18/the-four-layers-of-microservice-architecture">The Four Layers Of Microservice Architecture</a></li>
<li><a href="http://postd.cc/microservice-trade-offs/">マイクロサービスのトレードオフ</a></li>
<li><a href="https://ja.wikipedia.org/wiki/%E5%8D%98%E4%B8%80%E9%9A%9C%E5%AE%B3%E7%82%B9">SPOF(単一障害点）</a></li>
<li><a href="http://microservices.io/patterns/observability/health-check-api.html">Pattern: Health Check API</a></li>
<li><a href="http://microservices.io/patterns/reliability/circuit-breaker.html">Pattern: Circuit Breaker</a></li>
<li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/patterns/category/resiliency">Microsoft Docs:回復性のパターン</a>

<ul>
<li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/patterns/health-endpoint-monitoring">正常性エンドポイントの監視パターン</a></li>
<li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/patterns/circuit-breaker">サーキット ブレーカー パターン</a></li>
</ul></li>
<li><a href="https://www.youtube.com/watch?v=pKO33eMwXRs">YouTube:Building Fault Tolerant Microservices</a></li>
<li><a href="https://www.infoq.com/jp/news/2017/06/istio">Istio: マイクロサービスのためのサービスメッシュ</a></li>
<li><a href="http://kafka.apache.org/">Apache Kafka</a></li>
<li><a href="https://deeeet.com/writing/2015/09/01/apache-kafka/">Apache Kafkaに入門した</a></li>
<li><a href="https://www.slideshare.net/techblogyahoo/java-client-apache-kafka-jjugccc-ccce2">Java Clientで入門する Apache Kafka</a></li>
<li><a href="https://github.com/linki/chaoskube">linki/chaoskube</a></li>
<li><a href="https://www.skyarch.net/blog/?p=13294">【AWS re:Invent 2017】「カオスエンジニアリング」について</a></li>
<li><a href="https://www.katacoda.com/courses/kubernetes">Learn Kubernetes using Interactive Browser-Based Scenarios</a></li>
</ul>

<h1 id="関連">関連</h1>

<ul>
<li><a href="/2017/11/23/cndjp1/">Cloud Native Developers JP 第1回勉強会 参加メモ #cndjp1</a></li>
<li><a href="/2017/12/18/kubernetes-in-production-cndjp2/">[k8s]Cloud Native Developers JP 第2回勉強会 参加メモ #cndjp2</a></li>
</ul>

        </div>
        

<h2>関連記事</h2>
<ul>
  
  <li><a href="/2017/12/18/kubernetes-in-production-cndjp2/">[k8s]Cloud Native Developers JP 第2回勉強会 参加メモ #cndjp2</a></li>
  
  <li><a href="/2017/11/23/cndjp1/">Cloud Native Developers JP 第1回勉強会 参加メモ #cndjp1</a></li>
  
  <li><a href="/2018/01/31/golangtokyo-12/">[Go]golang.tokyo #12 参加メモ #golangtokyo</a></li>
  
</ul>


        <div class="addthis_inline_share_toolbox"></div>

        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c31cf997a7af863" async></script>
​<script type="text/javascript">
    var addthis_config = addthis_config||{};
    addthis_config.data_track_addressbar = false;
    addthis_config.data_track_clickback = false;
</script>

        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn"></span></span>
    
    <time>Feb 3, 2018</time>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="https://budougumi0617.github.io/tags/k8s">k8s</a>  <a class="category" href="https://budougumi0617.github.io/tags/chaoskube">chaoskube</a>  <a class="category" href="https://budougumi0617.github.io/tags/kafka">kafka</a>  <a class="category" href="https://budougumi0617.github.io/tags/cndjp">cndjp</a>  
    
    </span>
  </p>

  
  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://budougumi0617.github.io/2018/01/31/redashmeetup-hands-on/" title="Redash Meetup #0.1 - Redash 初心者向けハンズオン #redashmeetup">Redash Meetup #0.1 - Redash 初心者向けハンズオン #redashmeetup</a>
    

    
      <a class="basic-alignment right" href="https://budougumi0617.github.io/2018/02/03/grpc-gateway-for-rest-api/" title="[Go]gRPC GatewayでgRPCに対するREST APIを自動生成する">[Go]gRPC GatewayでgRPCに対するREST APIを自動生成する</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'http-budougumi0617-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    
      <h1>This blog</h1>
    

    <p>
      
        budougumi0617 の技術ブログです。
    </br>
    主にGoについて書いています。
    </br>
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/budougumi0617" title="https://github.com/budougumi0617"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/budougumi0617" title="https://twitter.com/budougumi0617"><i class="fa fa-twitter fa-3x"></i></a>
      
         
      
      <a target="_blank" href="https://www.linkedin.com/in/budougumi0617/" title="https://www.linkedin.com/in/budougumi0617/"><i class="fa fa-linkedin fa-3x"></i></a>
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  
    
      <section class="odd">
        
          <h1>Reccomend Categories</h1>
        
        
          <li>
            <a href="https://budougumi0617.github.io/categories/go/" title="Go" >Go</a>
          </li>
        
          <li>
            <a href="https://budougumi0617.github.io/categories/spinnaker/" title="Spinnaker" >Spinnaker</a>
          </li>
        
          <li>
            <a href="https://budougumi0617.github.io/categories/presentation/" title="発表資料" >発表資料</a>
          </li>
        
          <li>
            <a href="https://budougumi0617.github.io/categories/report/" title="イベントレポート" >イベントレポート</a>
          </li>
        
          <li>
            <a href="https://budougumi0617.github.io/categories/" title="その他のカテゴリー一覧" >その他のカテゴリー一覧</a>
          </li>
        
      </section>
    
  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
          
            
              <li class="post">
                <a href="/2019/02/08/go-slice-operator/">[Go]スライス生成時(slice operator)に使える珍しい宣言方法 #golangjp</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2019/02/01/how-to-use-analisys-package/">golang.org/x/tools/go/analysisでLinterツールを自作する #gounco #golang</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2019/01/26/publish-blog-kpi-collector/">GoogleスプレットシートでWebサイトのKPIを集計するためのOSSを作った #blog #gas</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2019/01/21/use-heatmap-by-userheat/">HugoブログにUser Heatを設置してヒートマップ分析をする</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2019/01/17/try-go-on-google-cloud-functions/">BetaリリースされたGoのGoogle Cloud Functionsを試す #gcp #golangjp</a>
              </li>
            
          
        </ul>
      </section>
    
  
</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2019  - <a href="https://budougumi0617.github.io/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>






<script>
  var _gaq=[['_setAccount','UA-43042615-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

