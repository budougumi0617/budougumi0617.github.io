<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
    
    
      <link href="/css/fonts.css" rel="stylesheet" type="text/css">
    
  

  
  <title>[発表資料] React&#43;Redux 次の一歩 補足資料 #WEBエンジニア勉強会10</title>

  
  
  <link rel="stylesheet" href="/css/hugo-octopress.css">

  
  

  
    <link rel="stylesheet" href="/css/fork-awesome.min.css">
  

  
  <link href="https://budougumi0617.github.io/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="">

  
  <meta name="generator" content="Hugo 0.50" />

  
  

  
  
    

  
    <meta name="twitter:card" content="summary"/>
  
  
  <meta name="twitter:title" content="[発表資料] React&#43;Redux 次の一歩 補足資料 #WEBエンジニア勉強会10"/>
  <meta name="twitter:description" content="WEBエンジニア勉強会 #10 (東京都, 渋谷)の発表資料と資料中の参考リンク、紹介ライブラリの導入手順をまとめた。

"/>
  
  <meta name="twitter:domain" content="budougumi0617.github.io"/>
  <meta name="twitter:creator" content="@budougumi0617"/>

  

  
  <script type="text/javascript">
    (function(add, cla){window['UserHeatTag']=cla;window[cla]=window[cla]||function(){(window[cla].q=window[cla].q||[]).push(arguments)},window[cla].l=1*new Date();var ul=document.createElement('script');var tag = document.getElementsByTagName('script')[0];ul.async=1;ul.src=add;tag.parentNode.insertBefore(ul,tag);})('//uh.nakanohito.jp/uhj2/uh.js', '_uhtracker');_uhtracker({id:'uhUEw1Gd9C'});
  </script>
  
</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="https://budougumi0617.github.io/">My External Storage</a></h1>
    <h2></h2>
</hgroup></header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
        <option value="https://budougumi0617.github.io/">» Home</option>
      
        <option value="https://budougumi0617.github.io/2017/07/11/about-this-site/">» About</option>
      
        <option value="https://budougumi0617.github.io/post/">» Archives</option>
      

  </select>
</fieldset>


<ul class="main-navigation">
  
  
    
      <li><a href="https://budougumi0617.github.io/" title="Home">Home</a></li>
    
  
    
      <li><a href="https://budougumi0617.github.io/2017/07/11/about-this-site/" title="About"  target="_blank" >About</a></li>
    
  
    
      <li><a href="https://budougumi0617.github.io/post/" title="Archives"  target="_blank" >Archives</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="https://budougumi0617.github.io/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
    <p class="meta">Nov 9, 2018
         - 8 minute read 
         - <a href="https://budougumi0617.github.io/2018/11/09/presentation-web-engineer-meetup-10/#disqus_thread">Comments</a>

        
        
        
            - <a class="label" href="https://budougumi0617.github.io/categories/presentation/">presentation </a><a class="label" href="https://budougumi0617.github.io/categories/react/">react </a>
        
    </p>
    <h1 class="entry-title">
         [発表資料] React&#43;Redux 次の一歩 補足資料 #WEBエンジニア勉強会10 
    </h1>
</header>


        <div class="entry-content">
          
          
          
          
          <p>WEBエンジニア勉強会 #10 (東京都, 渋谷)の発表資料と資料中の参考リンク、紹介ライブラリの導入手順をまとめた。</p>

<p></p>

<table>
<thead>
<tr>
<th>イベント名</th>
<th>WEBエンジニア勉強会 #10 (東京都, 渋谷)</th>
</tr>
</thead>

<tbody>
<tr>
<td>URL</td>
<td><a href="https://web-engineer-meetup.connpass.com/event/104523/">https://web-engineer-meetup.connpass.com/event/104523/</a></td>
</tr>

<tr>
<td>会場</td>
<td>株式会社ミクシィ 東京都渋谷区東1-2-20 住友不動産渋谷ファーストタワー7F</td>
</tr>

<tr>
<td>日時</td>
<td>2018/11/09(金) 19:30 〜 22:00</td>
</tr>

<tr>
<td>ハッシュタグ</td>
<td><a href="https://twitter.com/search?q=%23WEB%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E5%8B%89%E5%BC%B7%E4%BC%9A10">#WEBエンジニア勉強会10</a></td>
</tr>
</tbody>
</table>

<hr />

<ul>
<li>React+Redux 次の一歩

<ul>
<li><a href="https://speakerdeck.com/budougumi0617/the-next-step-from-react-and-redux">https://speakerdeck.com/budougumi0617/the-next-step-from-react-and-redux</a></li>
</ul></li>
</ul>

<script async class="speakerdeck-embed" data-id="364eedb4738e47ba9e57d4280b2a0693" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>

<h2 id="リポジトリ-バージョン情報">リポジトリ・バージョン情報</h2>

<p>本記事はスライドで紹介している各ライブラリの導入方法と概要をまとめている。各々は以下のリポジトリをcloneすることですぐ試すことができる。</p>

<ul>
<li><a href="https://github.com/budougumi0617/wem10-react-sample">https://github.com/budougumi0617/wem10-react-sample</a></li>
</ul>

<p>一部ずつ確認したい場合はコミットログを参照のこと。</p>

<ul>
<li><a href="https://github.com/budougumi0617/wem10-react-sample/commits/master">https://github.com/budougumi0617/wem10-react-sample/commits/master</a></li>
</ul>

<p>なお、本記事は以下のバージョンの実行環境で作成されている。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ npm version
<span style="color:#719e07">{</span> npm: <span style="color:#2aa198">&#39;5.6.0&#39;</span>,
  ares: <span style="color:#2aa198">&#39;1.13.0&#39;</span>,
  cldr: <span style="color:#2aa198">&#39;33.0&#39;</span>,
  http_parser: <span style="color:#2aa198">&#39;2.8.0&#39;</span>,
  icu: <span style="color:#2aa198">&#39;61.1&#39;</span>,
  modules: <span style="color:#2aa198">&#39;59&#39;</span>,
  napi: <span style="color:#2aa198">&#39;3&#39;</span>,
  nghttp2: <span style="color:#2aa198">&#39;1.32.0&#39;</span>,
  node: <span style="color:#2aa198">&#39;9.11.2&#39;</span>,
  openssl: <span style="color:#2aa198">&#39;1.0.2o&#39;</span>,
  tz: <span style="color:#2aa198">&#39;2018c&#39;</span>,
  unicode: <span style="color:#2aa198">&#39;10.0&#39;</span>,
  uv: <span style="color:#2aa198">&#39;1.19.2&#39;</span>,
  v8: <span style="color:#2aa198">&#39;6.2.414.46-node.23&#39;</span>,
  zlib: <span style="color:#2aa198">&#39;1.2.11&#39;</span> <span style="color:#719e07">}</span>
$ yarn -v
<span style="color:#2aa198">1</span>.9.4</code></pre></div>
<p>ベースとなるプロジェクトは<code>create-react-app</code>によって作成されている。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ npm install -g create-react-app
$ create-react-app --version
<span style="color:#2aa198">2</span>.1.1</code></pre></div>
<h1 id="eslint-prettier">ESLint + Prettier</h1>

<ul>
<li>ESLint

<ul>
<li><a href="https://eslint.org/">https://eslint.org/</a></li>
</ul></li>
<li>Prettier

<ul>
<li><a href="https://prettier.io/">https://prettier.io/</a></li>
</ul></li>
</ul>

<p>まず静的解析・フォーマッタの準備をする。<code>ESLint</code>は<code>create-react-app</code>の<code>v2.1.1</code> が<code>v5.6.0</code>しか認めないようなのでバージョンを固定している。
（本当は<code>ESLint</code>は<code>crreate-react-app</code>にプリインストールされているのだが、明示的にインストールしないと違うバージョンがインストールされてハマる）</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yarn add -D eslint@5.6.0 eslint-config-react-app eslint-plugin-import  eslint-plugin-react eslint-config-airbnb eslint-plugin-jsx-a11y
$ yarn add -D prettier prettier-eslint-cli eslint-config-prettier eslint-plugin-prettier</code></pre></div>
<p>次に<code>.eslintrc.js</code>という名前で設定ファイルを作成する（細かい設定内容の説明は割愛する）。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">module.exports <span style="color:#719e07">=</span> {
  parser<span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;babel-eslint&#34;</span>,
  <span style="color:#719e07">extends</span><span style="color:#719e07">:</span> [
    <span style="color:#2aa198">&#34;eslint:recommended&#34;</span>,
    <span style="color:#2aa198">&#34;plugin:react/recommended&#34;</span>,
    <span style="color:#2aa198">&#34;plugin:prettier/recommended&#34;</span>,
    <span style="color:#2aa198">&#34;prettier/react&#34;</span>
  ],
  env<span style="color:#719e07">:</span> {
    browser<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>
  },
  plugins<span style="color:#719e07">:</span> [<span style="color:#2aa198">&#34;react&#34;</span>, <span style="color:#2aa198">&#34;prettier&#34;</span>, <span style="color:#2aa198">&#34;jsx-a11y&#34;</span>],
  rules<span style="color:#719e07">:</span> {
    <span style="color:#2aa198">&#34;prettier/prettier&#34;</span><span style="color:#719e07">:</span> [
      <span style="color:#2aa198">&#34;error&#34;</span>,
      {
        singleQuote<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>,
        printWidth<span style="color:#719e07">:</span> <span style="color:#2aa198">100</span>
      }
    ],
    yoda<span style="color:#719e07">:</span> <span style="color:#2aa198">0</span>,
    <span style="color:#2aa198">&#34;no-unused-vars&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">1</span>,
    <span style="color:#2aa198">&#34;react/prefer-stateless-function&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">0</span>,
    <span style="color:#2aa198">&#34;react/jsx-filename-extension&#34;</span><span style="color:#719e07">:</span> [<span style="color:#2aa198">1</span>, { extensions<span style="color:#719e07">:</span> [<span style="color:#2aa198">&#34;.js&#34;</span>, <span style="color:#2aa198">&#34;.jsx&#34;</span>] }],
    <span style="color:#2aa198">&#34;jsx-a11y/href-no-hash&#34;</span><span style="color:#719e07">:</span> <span style="color:#2aa198">&#34;off&#34;</span>,
    <span style="color:#2aa198">&#34;jsx-a11y/anchor-is-valid&#34;</span><span style="color:#719e07">:</span> [<span style="color:#2aa198">&#34;warn&#34;</span>, { aspects<span style="color:#719e07">:</span> [<span style="color:#2aa198">&#34;invalidHref&#34;</span>] }]
  },
  globals<span style="color:#719e07">:</span> {
    $<span style="color:#719e07">:</span> <span style="color:#cb4b16">false</span>,
    describe<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>,
    it<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>,
    test<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>,
    expect<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>,
    process<span style="color:#719e07">:</span> <span style="color:#cb4b16">true</span>
  }
};
</code></pre></div>
<p>また、自動生成ファイルはLintから外れるように、以下の内容で<code>.eslintignore</code>という名前の設定ファイルも追加する。</p>

<pre><code>node_modules
**/*.min.js
src/registerServiceWorker.js
src/setupTests.js
</code></pre>

<p>これでバージョン差異などがなければ動くはずだ。例えば、こんな感じで<code>src/App.js</code>からセミコロンを一つ削除してみてからもう一度<code>yarn lint</code>コマンドを実行してみる。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#cb4b16">diff --git a/src/App.js b/src/App.js
</span><span style="color:#cb4b16">index 7e261ca..8850ce6 100644
</span><span style="color:#cb4b16"></span><span style="color:#dc322f">--- a/src/App.js
</span><span style="color:#dc322f"></span><span style="color:#719e07">+++ b/src/App.js
</span><span style="color:#719e07"></span><span style="color:#268bd2">@@ -21,7 +21,7 @@ class App extends Component {
</span><span style="color:#268bd2"></span>           &lt;/a&gt;
         &lt;/header&gt;
       &lt;/div&gt;
<span style="color:#dc322f">-    );
</span><span style="color:#dc322f"></span><span style="color:#719e07">+    )
</span><span style="color:#719e07"></span>   }
</code></pre></div>
<p>以下のようにPrettierのエラーが出ることがわかる。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yarn lint
yarn run v1.9.4
$ eslint src/**/*.js
Warning: React version not specified in eslint-plugin-react settings. See https://github.com/yannickcr/eslint-plugin-react#configuration.

/Users/budougumi0617/go/src/github.com/budougumi0617/wem10-react-sample/src/App.js
  <span style="color:#2aa198">24</span>:6  error  Insert <span style="color:#586e75">`</span>;<span style="color:#586e75">`</span>  prettier/prettier

✖ <span style="color:#2aa198">1</span> problem <span style="color:#719e07">(</span><span style="color:#2aa198">1</span> error, <span style="color:#2aa198">0</span> warnings<span style="color:#719e07">)</span>
  <span style="color:#2aa198">1</span> error and <span style="color:#2aa198">0</span> warnings potentially fixable with the <span style="color:#586e75">`</span>--fix<span style="color:#586e75">`</span> option.

error Command failed with <span style="color:#b58900">exit</span> code <span style="color:#2aa198">1</span>.
info Visit https://yarnpkg.com/en/docs/cli/run <span style="color:#719e07">for</span> documentation about this command.</code></pre></div>
<p>あとは各エディタ・IDEで上記の設定を確認するように設定すればエディタ側でエラー内容を確認したり、オートフォーマットができる。
検索サービスで<code>&lt;エディタの名前&gt; eslint prettier</code>と検索した通りに設定すれば大丈夫だろう。以下の画像はVS Codeで結果を表示する例だ。</p>

<p><img src="/2018/11/09-lint.png" alt="view on VS Code" /></p>

<h1 id="jest-enzyme">Jest + Enzyme</h1>

<ul>
<li>Option 1: Shallow Rendering

<ul>
<li><a href="https://github.com/facebook/create-react-app/blob/88aef1100f349f1718874f8263684fac6fa77a07/docusaurus/docs/running-tests.md#option-1-shallow-rendering">https://github.com/facebook/create-react-app/blob/88aef1100f349f1718874f8263684fac6fa77a07/docusaurus/docs/running-tests.md#option-1-shallow-rendering</a></li>
</ul></li>
<li>Jest

<ul>
<li><a href="https://jestjs.io/">https://jestjs.io/</a></li>
</ul></li>
<li>Enzyme

<ul>
<li><a href="https://github.com/airbnb/enzyme">https://github.com/airbnb/enzyme</a></li>
</ul></li>
</ul>

<p>次にテスト用のライブラリを追加する。
<code>create-react-app</code>を使っている場合、<code>Jest</code>はプリセットに含まれている。
なので、<code>Enzyme</code>に関連するライブラリをインストールするだけで実行可能だ。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yarn add -D enzyme enzyme-adapter-react-16 react-test-renderer</code></pre></div>
<p><code>src</code>ディレクトリに<code>setupTests.js</code>という名前で初期化ファイルを追加しておく。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> { configure } from <span style="color:#2aa198">&#39;enzyme&#39;</span>;
<span style="color:#719e07">import</span> Adapter from <span style="color:#2aa198">&#39;enzyme-adapter-react-16&#39;</span>;

configure({ adapter<span style="color:#719e07">:</span> <span style="color:#719e07">new</span> Adapter() });
</code></pre></div>
<p><code>Props</code>を変化させるテストを試してみたいので、<code>src/App.js</code>の内容を以下に書き換える。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> React, { Component } from <span style="color:#2aa198">&#39;react&#39;</span>;
<span style="color:#719e07">import</span> PropTypes from <span style="color:#2aa198">&#39;prop-types&#39;</span>;
<span style="color:#719e07">import</span> logo from <span style="color:#2aa198">&#39;./logo.svg&#39;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#39;./App.css&#39;</span>;

<span style="color:#719e07">class</span> App <span style="color:#719e07">extends</span> Component {
  render() {
    <span style="color:#719e07">return</span> (
      <span style="color:#719e07">&lt;</span>div className<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;App&#34;</span><span style="color:#719e07">&gt;</span>
        <span style="color:#719e07">&lt;</span>header className<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;App-header&#34;</span><span style="color:#719e07">&gt;</span>
          <span style="color:#719e07">&lt;</span>img src<span style="color:#719e07">=</span>{logo} className<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;App-logo&#34;</span> alt<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;logo&#34;</span> /&gt;
          <span style="color:#719e07">&lt;</span>h1 className<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;App-title&#34;</span><span style="color:#719e07">&gt;</span>Welcome to {<span style="color:#719e07">this</span>.props.text}<span style="color:#719e07">&lt;</span>/h1&gt;
        <span style="color:#719e07">&lt;</span>/header&gt;
        <span style="color:#719e07">&lt;</span>p className<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;App-intro&#34;</span><span style="color:#719e07">&gt;</span>
          To get started, edit <span style="color:#719e07">&lt;</span>code<span style="color:#719e07">&gt;</span>src/App.js&lt;/code&gt; and save to reload.
        <span style="color:#719e07">&lt;</span>/p&gt;
      <span style="color:#719e07">&lt;</span>/div&gt;
    );
  }
}

App.propTypes <span style="color:#719e07">=</span> {
  text<span style="color:#719e07">:</span> PropTypes.string
};

App.defaultProps <span style="color:#719e07">=</span> {
  text<span style="color:#719e07">:</span> <span style="color:#2aa198">&#39;React&#39;</span>
};

<span style="color:#719e07">export</span> <span style="color:#719e07">default</span> App;
</code></pre></div>
<p><code>src/__tests__</code>ディレクトリを作り<code>src/App.test.js</code>をその下に移動する。
その後、<code>src/__tests__/App.test.js</code>の内容を以下に書き換える。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> React from <span style="color:#2aa198">&#39;react&#39;</span>;
<span style="color:#719e07">import</span> { shallow } from <span style="color:#2aa198">&#39;enzyme&#39;</span>;

<span style="color:#719e07">import</span> App from <span style="color:#2aa198">&#39;./App&#39;</span>;

<span style="color:#719e07">const</span> emptyProps <span style="color:#719e07">=</span> {
  text<span style="color:#719e07">:</span> <span style="color:#2aa198">&#39;test&#39;</span>
};

describe(<span style="color:#2aa198">&#39;App&#39;</span>, () =&gt; {
  describe(<span style="color:#2aa198">&#39;App-title&#39;</span>, () =&gt; {
    <span style="color:#719e07">const</span> cases <span style="color:#719e07">=</span> [
      [<span style="color:#2aa198">&#39;simple test1&#39;</span>, { text<span style="color:#719e07">:</span> <span style="color:#2aa198">&#39;Jest&#39;</span> }, <span style="color:#2aa198">&#39;Welcome to Jest&#39;</span>],
      [<span style="color:#2aa198">&#39;simple test2&#39;</span>, { text<span style="color:#719e07">:</span> <span style="color:#2aa198">&#39;enzyme&#39;</span> }, <span style="color:#2aa198">&#39;Welcome to enzyme&#39;</span>]
    ];
    describe.each(cases)(<span style="color:#2aa198">&#39;change Props&#39;</span>, (title, override, expected) =&gt; {
      it(title, () =&gt; {
        <span style="color:#719e07">const</span> customProps <span style="color:#719e07">=</span> <span style="color:#b58900">Object</span>.assign({}, emptyProps, override);
        <span style="color:#719e07">const</span> wrapper <span style="color:#719e07">=</span> shallow(<span style="color:#719e07">&lt;</span>App {...customProps} /&gt;);
        expect(wrapper.instance().props.text).toBe(customProps.text);
        expect(wrapper.find(<span style="color:#2aa198">&#39;.App-title&#39;</span>).text()).toBe(expected);
      });
    });
  });
});
</code></pre></div>
<p>次に<code>src/setupTests.js</code>を以下の内容で作成する。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> { configure } from <span style="color:#2aa198">&#39;enzyme&#39;</span>;
<span style="color:#719e07">import</span> Adapter from <span style="color:#2aa198">&#39;enzyme-adapter-react-16&#39;</span>;

configure({ adapter<span style="color:#719e07">:</span> <span style="color:#719e07">new</span> Adapter() });
</code></pre></div>
<p>ここまで行なって<code>yarn test</code>を実行し、以下のような実行結果が得られればテストを書く準備が完了している。
Usegeの通り、<code>Jest</code>は特に何も指定しないとホットリロードモードでプロセスが終わらないので、終わるときは<code>q</code>を入力する</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PASS  src/__tests__/App.test.js
  App
    App-title
      change Props
        ✓ simple test1 <span style="color:#719e07">(</span>13ms<span style="color:#719e07">)</span>
        ✓ simple test2 <span style="color:#719e07">(</span>2ms<span style="color:#719e07">)</span>

Test Suites: <span style="color:#2aa198">1</span> passed, <span style="color:#2aa198">1</span> total
Tests:       <span style="color:#2aa198">2</span> passed, <span style="color:#2aa198">2</span> total
Snapshots:   <span style="color:#2aa198">0</span> total
Time:        <span style="color:#2aa198">5</span>.871s
Ran all <span style="color:#b58900">test</span> suites related to changed files.

Watch Usage
 › Press a to run all tests.
 › Press f to run only failed tests.
 › Press p to filter by a filename regex pattern.
 › Press t to filter by a <span style="color:#b58900">test</span> name regex pattern.
 › Press q to quit watch mode.
 › Press Enter to trigger a <span style="color:#b58900">test</span> run.</code></pre></div>
<p><img src="/2018/11/09-test.gif" alt="hot reload test" /></p>

<h1 id="スナップショットテスト">スナップショットテスト</h1>

<ul>
<li><a href="https://jestjs.io/docs/en/snapshot-testing">https://jestjs.io/docs/en/snapshot-testing</a></li>
</ul>

<p><code>src/__tests__</code>ディレクトリを作り、<code>src/__tests__/Snapshot.test.js</code>を以下の内容で作成する。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> React from <span style="color:#2aa198">&#39;react&#39;</span>;
<span style="color:#719e07">import</span> App from <span style="color:#2aa198">&#39;../App&#39;</span>;
<span style="color:#719e07">import</span> renderer from <span style="color:#2aa198">&#39;react-test-renderer&#39;</span>;

it(<span style="color:#2aa198">&#39;renders correctly&#39;</span>, () =&gt; {
  <span style="color:#719e07">const</span> tree <span style="color:#719e07">=</span> renderer.create(<span style="color:#719e07">&lt;</span>App text<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;Snapshot&#34;</span> /&gt;).toJSON();
  expect(tree).toMatchSnapshot();
});
</code></pre></div>
<p>この状態で<code>yarn test</code>を行なうと、スナップショットテストが実行され、<code>src/__tests__/__snapshots__/Snapshot.test.js.snap</code>というファイルが生成される。
ここに現在の<code>App</code>コンポーネントをレンダリングした結果が保存されて、次回以降のテストでリグレッションテストが行われる。
もし、意図的にレンダリング結果が変わる変更をした場合はこのスナップショットファイルを更新する必要がある。
そのため、以下のコマンドを<code>package.json</code>に追加しておく。</p>

<pre><code>diff --git a/package.json b/package.json
index fc2033d..e760ea4 100644
--- a/package.json
+++ b/package.json
@@ -11,6 +11,7 @@
     &quot;start&quot;: &quot;react-scripts start&quot;,
     &quot;build&quot;: &quot;react-scripts build&quot;,
     &quot;test&quot;: &quot;react-scripts test&quot;,
+    &quot;updateSnapshot&quot;: &quot;react-scripts test --updateSnapshot&quot;,
     &quot;eject&quot;: &quot;react-scripts eject&quot;,
     &quot;lint&quot;: &quot;eslint src/**/*.js&quot;,
     &quot;eslint-check&quot;: &quot;eslint --print-config .eslintrc.js | eslint-config-prettier-check&quot;
</code></pre>

<h1 id="storybook">Storybook</h1>

<ul>
<li><a href="https://storybook.js.org/">https://storybook.js.org/</a></li>
</ul>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ yarn add -D @storybook/react @storybook/addons @storybook/addon-actions @storybook/addon-links
$ yarn add -D @storybook/addon-notes @storybook/addon-knobs @storybook/addon-events
$ yarn add -D @storybook/addon-options @storybook/addon-backgrounds @storybook/addon-storyshots babel-core babel-loader</code></pre></div>
<p><code>package.json</code>にstorybook起動用のコマンドを追加する。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#cb4b16">diff --git a/package.json b/package.json
</span><span style="color:#cb4b16">index e760ea4..0b3918b 100644
</span><span style="color:#cb4b16"></span><span style="color:#dc322f">--- a/package.json
</span><span style="color:#dc322f"></span><span style="color:#719e07">+++ b/package.json
</span><span style="color:#719e07"></span><span style="color:#268bd2">@@ -14,7 +14,8 @@
</span><span style="color:#268bd2"></span>     &#34;updateSnapshot&#34;: &#34;react-scripts test --updateSnapshot&#34;,
     &#34;eject&#34;: &#34;react-scripts eject&#34;,
     &#34;lint&#34;: &#34;eslint src/**/*.js&#34;,
<span style="color:#dc322f">-    &#34;eslint-check&#34;: &#34;eslint --print-config .eslintrc.js | eslint-config-prettier-check&#34;
</span><span style="color:#dc322f"></span><span style="color:#719e07">+    &#34;eslint-check&#34;: &#34;eslint --print-config .eslintrc.js | eslint-config-prettier-check&#34;,
</span><span style="color:#719e07">+    &#34;storybook&#34;: &#34;start-storybook -p 9001 -c .storybook&#34;
</span><span style="color:#719e07"></span>   },
   &#34;eslintConfig&#34;: {
     &#34;extends&#34;: &#34;react-app&#34;
</code></pre></div>
<p><code>.storybook</code>ディレクトリを作成し、<code>.storybook/config.js</code>にファイルのロード設定をする。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> { configure } from <span style="color:#2aa198">&#34;@storybook/react&#34;</span>;
 <span style="color:#719e07">const</span> req <span style="color:#719e07">=</span> require.context(<span style="color:#2aa198">&#34;../stories&#34;</span>, <span style="color:#cb4b16">true</span>, <span style="color:#dc322f">/.stories.js$/</span>); <span style="color:#586e75">// &lt;- import all the stories at once
</span><span style="color:#586e75"></span> <span style="color:#268bd2">function</span> loadStories() {
  req.keys().forEach(filename =&gt; req(filename));
}
 configure(loadStories, module);
</code></pre></div>
<p><code>.storybook/addons.js</code>を作成してアドオンを読み込む設定をする。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-actions/register&#34;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-links/register&#34;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-events/register&#34;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-notes/register&#34;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-options/register&#34;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-knobs/register&#34;</span>;
<span style="color:#719e07">import</span> <span style="color:#2aa198">&#34;@storybook/addon-backgrounds/register&#34;</span>;
</code></pre></div>
<p><code>stories</code>ディレクトリを作成し、動作確認用に<code>stories/index.stories.js</code>を作成する。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#719e07">import</span> React from <span style="color:#2aa198">&#39;react&#39;</span>;
<span style="color:#719e07">import</span> { storiesOf } from <span style="color:#2aa198">&#39;@storybook/react&#39;</span>;
<span style="color:#719e07">import</span> { action } from <span style="color:#2aa198">&#39;@storybook/addon-actions&#39;</span>;
<span style="color:#719e07">import</span> { Button } from <span style="color:#2aa198">&#39;@storybook/react/demo&#39;</span>;
<span style="color:#719e07">import</span> { withKnobs, text, <span style="color:#268bd2">boolean</span>, number } from <span style="color:#2aa198">&#39;@storybook/addon-knobs&#39;</span>;
 storiesOf(<span style="color:#2aa198">&#39;Button&#39;</span>, module)
  .addDecorator(withKnobs)
  .add(<span style="color:#2aa198">&#39;with text&#39;</span>, () =&gt; <span style="color:#719e07">&lt;</span>Button onClick<span style="color:#719e07">=</span>{action(<span style="color:#2aa198">&#39;clicked&#39;</span>)}<span style="color:#719e07">&gt;</span>Hello Button<span style="color:#719e07">&lt;</span>/Button&gt;)
  .add(<span style="color:#2aa198">&#39;with some emoji&#39;</span>, () =&gt; (
    <span style="color:#719e07">&lt;</span>Button onClick<span style="color:#719e07">=</span>{action(<span style="color:#2aa198">&#39;clicked&#39;</span>)}<span style="color:#719e07">&gt;</span>
      <span style="color:#719e07">&lt;</span>span role<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;img&#34;</span> aria<span style="color:#719e07">-</span>label<span style="color:#719e07">=</span><span style="color:#2aa198">&#34;so cool&#34;</span><span style="color:#719e07">&gt;</span>
        😀 😎 👍 💯
      <span style="color:#719e07">&lt;</span>/span&gt;
    <span style="color:#719e07">&lt;</span>/Button&gt;
  ));
 <span style="color:#586e75">// second stories
</span><span style="color:#586e75"></span><span style="color:#719e07">const</span> stories <span style="color:#719e07">=</span> storiesOf(<span style="color:#2aa198">&#39;Storybook Knobs&#39;</span>, module);
 <span style="color:#586e75">// Add the `withKnobs` decorator to add knobs support to your stories.
</span><span style="color:#586e75">// You can also configure `withKnobs` as a global decorator.
</span><span style="color:#586e75"></span>stories.addDecorator(withKnobs);
 <span style="color:#586e75">// Knobs for React props
</span><span style="color:#586e75"></span>stories.add(<span style="color:#2aa198">&#39;with a button&#39;</span>, () =&gt; (
  <span style="color:#719e07">&lt;</span>button disabled<span style="color:#719e07">=</span>{<span style="color:#268bd2">boolean</span>(<span style="color:#2aa198">&#39;Disabled&#39;</span>, <span style="color:#cb4b16">false</span>)}<span style="color:#719e07">&gt;</span>{text(<span style="color:#2aa198">&#39;Label&#39;</span>, <span style="color:#2aa198">&#39;Hello Storybook&#39;</span>)}<span style="color:#719e07">&lt;</span>/button&gt;
));
 <span style="color:#586e75">// Knobs as dynamic variables.
</span><span style="color:#586e75"></span>stories.add(<span style="color:#2aa198">&#39;as dynamic variables&#39;</span>, () =&gt; {
  <span style="color:#719e07">const</span> name <span style="color:#719e07">=</span> text(<span style="color:#2aa198">&#39;Name&#39;</span>, <span style="color:#2aa198">&#39;Arunoda Susiripala&#39;</span>);
  <span style="color:#719e07">const</span> age <span style="color:#719e07">=</span> number(<span style="color:#2aa198">&#39;Age&#39;</span>, <span style="color:#2aa198">89</span>);
   <span style="color:#719e07">const</span> content <span style="color:#719e07">=</span> <span style="color:#586e75">`I am </span><span style="color:#2aa198">${</span>name<span style="color:#2aa198">}</span><span style="color:#586e75"> and I&#39;m </span><span style="color:#2aa198">${</span>age<span style="color:#2aa198">}</span><span style="color:#586e75"> years old.`</span>;
  <span style="color:#719e07">return</span> <span style="color:#719e07">&lt;</span>div<span style="color:#719e07">&gt;</span>{content}<span style="color:#719e07">&lt;</span>/div&gt;;
});
</code></pre></div>
<p><code>yarn storybook</code>を実行して<code>localhost:9001</code>にStorybookが表示されれば成功だ。
以下のようにブラウザで各コンポーネントを操作できる。</p>

<p><img src="/2018/11/09-storybook.gif" alt="storybook" /></p>

<h1 id="netlifyでデプロイする">Netlifyでデプロイする</h1>

<ul>
<li><a href="https://www.netlify.com/">https://www.netlify.com/</a></li>
</ul>

<p>まずここまでのソースコードをGitHubに公開しておく。
<code>create-react-app</code>を使ったプロジェクトならばGit用の設定が済んでいるので以下のコマンドで全てコミットする。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git add --all
$ git commit -v -a</code></pre></div>
<p>GitHubにリポジトリを作ったら、そのリポジトリのURLをリモートリポジトリとして登録し、変更をプッシュする。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git remote add git@github.com:<span style="color:#2aa198">${</span><span style="color:#268bd2">USER_NAME</span><span style="color:#2aa198">}</span>/<span style="color:#2aa198">${</span><span style="color:#268bd2">REPO_NAME</span><span style="color:#2aa198">}</span>.git
$ git pull
<span style="color:#586e75"># rebaseしてリモートのinit commitとマージしておく
</span><span style="color:#586e75"></span>$ git rebase origin/master
$ git push origin master</code></pre></div>
<ul>
<li>Netlify

<ul>
<li><a href="https://www.netlify.com/">https://www.netlify.com/</a></li>
</ul></li>
</ul>

<p>GitHub連携などで、サインアップしたあとに以下のURLをクリックする（もしくはログイン後のページで「New site from Git」ボタンをクリックする）。</p>

<ul>
<li>Create a new site

<ul>
<li><a href="https://app.netlify.com/start">https://app.netlify.com/start</a></li>
</ul></li>
</ul>

<p>あとは作成したリポジトリを選ぶ。「3. Build options, and deploy!」ページの設定はそのまま「Deploy site」ボタンをクリックする</p>

<p>そのままビルドを待っていればサイトが公開される。</p>

<ul>
<li>Demo site

<ul>
<li><a href="https://wem10-react-sample.netlify.com/">https://wem10-react-sample.netlify.com/</a></li>
</ul></li>
</ul>

<p><img src="/2018/11/09-deploy.png" alt="deploy" /></p>

<p>公開されるURLはランダム値になるため、上記のURLは以下のページからURLを指定の文字列に変更している。</p>

<ul>
<li>Site details

<ul>
<li><a href="https://app.netlify.com/sites/${YOUR_REPOSITORY_NAME}/settings/general">https://app.netlify.com/sites/${YOUR_REPOSITORY_NAME}/settings/general</a></li>
</ul></li>
</ul>

<p>以降はなにもしなくてもGitHubのmasterブランチにプッシュするたびに自動でビルドされて更新される。</p>

<p>様々な設定ができるが、例えばビルド時に通知が欲しい場合は以下に登録すればよい。自分の場合はSlackの通知などを設定している。</p>

<ul>
<li>Deploy notifications

<ul>
<li><a href="https://app.netlify.com/sites/${YOUR_REPOSITORY_NAME}/settings/deploys#deploy-notifications">https://app.netlify.com/sites/${YOUR_REPOSITORY_NAME}/settings/deploys#deploy-notifications</a></li>
</ul></li>
</ul>

<p><img src="/2018/11/09-notify.png" alt="slack notification" /></p>

<h1 id="終わりに">終わりに</h1>

<p>「コミットログきれいなサンプルリポジトリ作っておこう！」と思って改めてプロジェクトを作成したのだが、２，３ヶ月前に<code>create-react-app</code>したときとだいぶ中身が変わっていた気がする。もし動かなかったときはバージョンを確認してもらいたい。</p>

<ul>
<li><a href="https://github.com/budougumi0617/wem10-react-sample">https://github.com/budougumi0617/wem10-react-sample</a></li>
</ul>

<h1 id="参考リンク">参考リンク</h1>

<ul>
<li><a href="/2018/09/12/type-can-only-be-used-in-a-dot-ts-file-on-vim/">Vim + ALEでReact+Flowなファイルを開くと&rsquo;type aliases&rsquo; can only be used in a .ts file.と怒られる #react #eslint)</a></li>
<li><a href="/2018/09/28/react-table-driven-test-by-jest-enzyme/">Jest( &gt;23.0.0 )、enzymeでReactのテーブル駆動テストを行う #react #test</a></li>
</ul>
        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn"></span></span>
    
    <time>Nov 9, 2018</time>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="https://budougumi0617.github.io/tags/react">react</a>  <a class="category" href="https://budougumi0617.github.io/tags/jest">jest</a>  <a class="category" href="https://budougumi0617.github.io/tags/storybook">storybook</a>  <a class="category" href="https://budougumi0617.github.io/tags/redux">redux</a>  <a class="category" href="https://budougumi0617.github.io/tags/netlify">netlify</a>  <a class="category" href="https://budougumi0617.github.io/tags/enzyme">enzyme</a>  
    
    </span>
  </p>

  
  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://budougumi0617.github.io/2018/10/30/review-writing-an-gnterpreter-in-go/" title="[書評] Go言語でつくるインタプリタ を読んだ #go">[書評] Go言語でつくるインタプリタ を読んだ #go</a>
    

    
      <a class="basic-alignment right" href="https://budougumi0617.github.io/2018/11/18/loop-by-time-tick-in-golang/" title="[Go] n秒おきになにかするループをtime.Tickで書く #go">[Go] n秒おきになにかするループをtime.Tickで書く #go</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'http-budougumi0617-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/budougumi0617" title="https://github.com/budougumi0617"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/budougumi0617" title="https://twitter.com/budougumi0617"><i class="fa fa-twitter fa-3x"></i></a>
      
         
      
      <a target="_blank" href="https://www.linkedin.com/in/budougumi0617/" title="https://www.linkedin.com/in/budougumi0617/"><i class="fa fa-linkedin fa-3x"></i></a>
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  
    
      <section class="odd">
        
          <h1>Archives</h1>
        
        
          <li>
            <a href="https://budougumi0617.github.io/categories/" title="Categories" >Categories</a>
          </li>
        
          <li>
            <a href="https://budougumi0617.github.io/tags/" title="Tags" >Tags</a>
          </li>
        
      </section>
    
  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
          
            
              <li class="post">
                <a href="/2018/12/27/retrospective-2018/">2018年振り返り</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2018/12/19/report-golangtokyo-20/">golang.tokyo #20 忘年LT大会！！ 参加メモ #golangtokyo</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2018/12/15/retrospective-on-github/">2018年振り返り(GitHub編)</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2018/12/14/how-to-use-google-wire/">google/wireを使ったDIとDI関数のシグネチャについて #go</a>
              </li>
            
          
            
              <li class="post">
                <a href="/2018/12/09/mecab-undefined-symbols-for-architecture-x86_64/">[Go] bluele/mecab-golangを含むコードをビルドすると Undefined symbols for architecture x86_64 と出て失敗する</a>
              </li>
            
          
        </ul>
      </section>
    
  
</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2019  - <a href="https://budougumi0617.github.io/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>






<script>
  var _gaq=[['_setAccount','UA-43042615-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

